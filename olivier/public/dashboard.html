<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard — SwapIt</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="js/supabase-client.js" type="module"></script>
</head>
<body>
  <header class="nav">
    <div class="container nav__bar">
      <a class="logo" href="index.html"><span>SWAP</span>IT</a>
      <nav class="nav__menu">
        <a href="browse.html">Browse</a>
        <a href="add-listing.html">Add Listing</a>
        <a href="profile.html">Profile</a>
        <a href="cart.html">Cart</a>
      </nav>
      <div class="nav__cta">
        <button id="logoutBtn" class="btn">Logout</button>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <h1>Welcome to your Dashboard</h1>
      <div id="welcomeBox">
        <p id="welcomeText">Loading your info…</p>
        <div style="margin-top:12px">
          <a class="btn btn--primary" href="add-listing.html">Add a new listing</a>
          <a class="btn" href="profile.html">Edit Profile</a>
        </div>
      </div>

      <section style="margin-top:24px">
        <h2>Your quick actions</h2>
        <ul>
          <li><a href="add-listing.html">Create listing</a></li>
          <li><a href="browse.html">Browse items</a></li>
          <li><a href="cart.html">View cart</a></li>
        </ul>
      </section>
    </div>
  </main>

  <script>
    async function init() {
      try {
        if (typeof window.SUPABASE_READY !== 'undefined') {
          const r = await window.SUPABASE_READY;
          if (r?.error) throw r.error;
        }

        const { data } = await window.supabase.auth.getUser();
        const user = data?.user;
        if (!user) {
          window.location.href = 'login.html';
          return;
        }
        document.getElementById('welcomeText').textContent = `Hello, ${user.email}`;

        document.getElementById('logoutBtn').addEventListener('click', async () => {
          await window.supabase.auth.signOut();
          window.location.href = 'index.html';
        });
      } catch (err) {
        console.warn(err);
      }
    }
    init();
  </script>
</body>
</html>
